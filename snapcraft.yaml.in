name: sparrow-app
title: Sparrow App
base: core24
version: '${SPARROW_VERSION}'

summary: An API management platform that streamlines software development.
description: |
  Sparrow is a modern API management platform designed to simplify and accelerate the software development lifecycle. It enables teams to manage APIs more efficiently through features like request handling, environment configuration, collection management, and access control across workspaces. Ideal for developers, QA engineers, and cross-functional teams, Sparrow fosters collaboration by allowing multiple teams to work together seamlessly. It addresses common pain points such as scattered API documentation, inefficient testing workflows, and limited team coordination by providing a centralized, user-friendly platform for all API-related tasks.

grade: stable
confinement: strict

apps:
  sparrow:
    command: usr/bin/sparrow
    extensions: [gnome]
    plugs:
      - network
      - network-status
      - home
      - desktop
      - desktop-legacy
      - wayland
      - x11
      - opengl
      - gsettings
      - pulseaudio
      - single-instance-plug
    slots:
      - single-instance

slots:
  single-instance:
    interface: dbus
    bus: session
    name: org.dev_sparrowapp_desktop.SingleInstance

plugs:
  single-instance-plug:
    interface: dbus
    bus: session
    name: org.dev_sparrowapp_desktop.SingleInstance

parts:
  sparrow:
    plugin: dump
    source: .
    build-packages:
      - build-essential
      - curl
      - wget
      - file
      - libxdo-dev
      - libssl-dev
      - librsvg2-dev
      - dpkg
    override-build: |
      set -eux
      # Extract the downloaded .deb into the snap install area
      dpkg -x sparrow.deb "$SNAPCRAFT_PART_INSTALL/"
      # Patch the desktop file icon path
      if [ -f "$SNAPCRAFT_PART_INSTALL/usr/share/applications/sparrow.desktop" ]; then
        sed -i 's|Icon=sparrow|Icon=/usr/share/icons/hicolor/32x32/apps/sparrow.png|' \
            "$SNAPCRAFT_PART_INSTALL/usr/share/applications/sparrow.desktop"
      fi